import { Tab, Tabs } from 'nextra-theme-docs';
import { Callout } from 'nextra-theme-docs'

# Create file upload

<Callout type="info" emoji="ℹ️">
  Files that are uploaded to ROQ Platform are stored on [Scaleway Object Storage](https://www.scaleway.com/en/object-storage/). The data center is located in Paris. 
</Callout>

To upload file via API you need to proceed the following steps. Alternatively you can use ROQ's [File Upload UI
component](/ui-components/file-upload).

1. Generate a signed URL using the `createFileUpload()` API
2. Upload file via the signed URL
3. Set status of the file using the `updateFileStatus()` API

## createFileUpload()

The `createFileUpload` API returns a "signed URL" which is then used to upload the file directly from the user's browser
to the object storage.

{/* TODO Replace code  */}

<Tabs items={['GraphQL']}><Tab>

```graphql
mutation createFileUpload($createFileDto: FileCreateDto!) {
  createFileUpload(createFileDto: $createFileDto) {
    id
    uploadUrl
    formFields
  }
}
```

</Tab></Tabs>


## Upload file via CURL

You should use the UI component

```shell
curl 'https://s3.fr-par.scw.cloud/<bucket-name>' \
  -H 'authority: s3.fr-par.scw.cloud' \
  -H 'accept: application/json, text/plain, */*' \
  -H 'accept-language: en-US,en;q=0.9' \
  -H 'content-type: multipart/form-data; boundary=----WebKitFormBoundary3Vy59GxeQOgK5rAa' \
  -H 'sec-fetch-mode: cors' \
  -H 'sec-fetch-site: cross-site' \
  --data-raw $'------WebKitFormBoundary3Vy59GxeQOgK5rAa\r\nContent-Disposition: form-data; name="maxSize"\r\n\r\n30000000\r\n------WebKitFormBoundary3Vy59GxeQOgK5rAa\r\nContent-Disposition: form-data; name="Content-Type"\r\n\r\nimage/png\r\n------WebKitFormBoundary3Vy59GxeQOgK5rAa\r\nContent-Disposition: form-data; name="expiryTime"\r\n\r\n3600\r\n------WebKitFormBoundary3Vy59GxeQOgK5rAa\r\nContent-Disposition: form-data; name="bucket"\r\n\r\ncfa9f507-3814-41a8-89ed-eda311c3cf04-environment-bucket\r\n------WebKitFormBoundary3Vy59GxeQOgK5rAa\r\nContent-Disposition: form-data; name="X-Amz-Algorithm"\r\n\r\nAWS4-HMAC-SHA256\r\n------WebKitFormBoundary3Vy59GxeQOgK5rAa\r\nContent-Disposition: form-data; name="X-Amz-Credential"\r\n\r\nSCWAGWH40FYY82QDFCKQ/20221219/fr-par/s3/aws4_request\r\n------WebKitFormBoundary3Vy59GxeQOgK5rAa\r\nContent-Disposition: form-data; name="X-Amz-Date"\r\n\r\n20221219T224853Z\r\n------WebKitFormBoundary3Vy59GxeQOgK5rAa\r\nContent-Disposition: form-data; name="key"\r\n\r\nwow-1671490133391.png\r\n------WebKitFormBoundary3Vy59GxeQOgK5rAa\r\nContent-Disposition: form-data; name="Policy"\r\n\r\neyJleHBpcmF0aW9uIjoiMjAyMi0xMi0xOVQyMzo0ODo1M1oiLCJjb25kaXRpb25zIjpbWyJjb250ZW50LWxlbmd0aC1yYW5nZSIsMCwiMzAwMDAwMDAiXSxbImVxIiwiJENvbnRlbnQtVHlwZSIsImltYWdlL3BuZyJdLHsibWF4U2l6ZSI6IjMwMDAwMDAwIn0seyJDb250ZW50LVR5cGUiOiJpbWFnZS9wbmcifSx7ImV4cGlyeVRpbWUiOiIzNjAwIn0seyJidWNrZXQiOiJjZmE5ZjUwNy0zODE0LTQxYTgtODllZC1lZGEzMTFjM2NmMDQtZW52aXJvbm1lbnQtYnVja2V0In0seyJYLUFtei1BbGdvcml0aG0iOiJBV1M0LUhNQUMtU0hBMjU2In0seyJYLUFtei1DcmVkZW50aWFsIjoiU0NXQUdXSDQwRllZODJRREZDS1EvMjAyMjEyMTkvZnItcGFyL3MzL2F3czRfcmVxdWVzdCJ9LHsiWC1BbXotRGF0ZSI6IjIwMjIxMjE5VDIyNDg1M1oifSx7ImtleSI6Indvdy0xNjcxNDkwMTMzMzkxLnBuZyJ9XX0=\r\n------WebKitFormBoundary3Vy59GxeQOgK5rAa\r\nContent-Disposition: form-data; name="X-Amz-Signature"\r\n\r\n85e782d229de979d1879ccbf104cc9ae2f3a9140f0efa1a247684f7d69702569\r\n------WebKitFormBoundary3Vy59GxeQOgK5rAa\r\nContent-Disposition: form-data; name="file"; filename="wow.png"\r\nContent-Type: image/png\r\n\r\n\r\n------WebKitFormBoundary3Vy59GxeQOgK5rAa--\r\n' \
  --compressed
```


{/* TODO ADd curl command to upload a file */}

## updateFileStatus()

When the upload is finished, you need to set the status of the upload. This is needed because the file is uploaded
directly to the object storage and therefore bypasses ROQ Platform.

<Tabs items={['GraphQL']}><Tab>

```graphql
mutation{
  updateFileStatus(
    fileId: "8f628084-7f6f-429b-9137-79620646a9be",
    status: READY
  ){
    id
    createdAt
    updatedAt
  }
}
```

</Tab></Tabs>



# Change visibility of a file

A file can be either public or private. Public means that there is a permanent URL which can be used by anyone, while
private files can only be accessed by user who are allowed to do so. The visibility of a file can be changed in the
console or via API using the `makeFilePublic()` and `makeFilePrivate()` methods.

## makeFilePublic()

To hide a file from public access, you can execute:

<Tabs items={['GraphQL']}><Tab>
```graphql
mutation makeFilePublic($fileId: ID!) {
  makeFilePublic(fileId: $fileId) {
    id
  }
}
```
</Tab></Tabs>

## makeFilePrivate()

To enable public access to a file, run:

<Tabs items={['GraphQL']}><Tab>
```graphql
mutation makeFilePrivate($fileId: ID!) {
  makeFilePrivate(fileId: $fileId) {
    id
  }
}
```
</Tab></Tabs>
import { Tab, Tabs } from 'nextra-theme-docs';

# Webhooks overview

## Introduction

ROQ uses webhooks to notify your application when an event happens in your account.
Actually, webhooks are useful for asynchronous events like when a conversation is created though chat,
a user is signed up or when file was uploaded.
ROQ uses HTTPS to send these notifications to your app as a JSON payload.
You can then use these notifications to execute actions in your backend systems.

## Events overview

At the moment ROQ is providing events for entities: **Users**, **User invites**, **Conversations**, **Messages**, **Files**
and actions: **Insert**, **Update**, **Remove**. <br/>
If you registered a webhook endpoint to receive some kind of event,
this will be sent to your endpoint as part of a POST request.
Entity object in the payload will be same as you can receive thought GraphQL API or Backend SDK.
Here is example of webhook payload:

```json
{
  "name": "ROQ_USER_INSERT",
  "id": "user-id",
  "object": "user",
  "data": {
    "current": {
      "reference": "user-reference",
      "email": "user-email",
      "locale": "user-locale",
      "tenantId": "user-tenant",
      "phone": "user-phone",
      "firstName": "user-firstName",
      "lastName": "user-lastName",
      "avatarUrl": "user-avatarUrl",
      "timezone":  "user-timezone",
      "active": true,
      "customData": null,
      "id": "user-id",
      "isOptedIn": true,
      "createdAt": "user-createdAt",
      "updatedAt": "user-updatedAt"
    },
    "previous": null
  },
  "environmentId": "your-environment-id"
}
```

## How to create webhook endpoint

Creating a webhook endpoint is no different from creating endpoint in your API.
We recommend to use HTTPS endpoint for publicly accessible APIs. <br/>
ROQ does not provide the option to set up several urls, soYou should use one endpoint to handle all event types.
Based on ```event.name``` you can have different logic for specific event type. <br/>
Your endpoint must quickly return a successful status code (2xx) prior to any complex logic that could cause a timeout.
The other way around you can configure longer timeout in Console UI.

## How to test webhook endpoint locally

As your local machine is not publicly available, our remote API is not able to call to it, so we recommend using
some external tooling to proxy the request during development. You can try an open source [Ngrok](https://www.npmjs.com/package/ngrok).
You can set the proxying URL using Console UI.

## How to secure webhook endpoint (recommended)

We recommend verifying the request incoming to your webhook endpoint to be sure that it didnâ€™t come from a server acting like ROQ. <br/>
ROQ is sending ```roq-platform-webhook-key``` header with any request triggered on specific event, and it can be used on your side for validating the sender.
```webhookKey``` secret can be copied along with all other environment variables at the moment,
when webhook feature was enabled for this environment in Console UI.
You can use SDK for validating ```roq-platform-webhook-key``` value.

<Tabs items={['Node.js SDK']}><Tab>

    ```typescript
    await client.verifyWebhookHeader(headers['roq-platform-webhook-key']);
    ```

</Tab></Tabs>
